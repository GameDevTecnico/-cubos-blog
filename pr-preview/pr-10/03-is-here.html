<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
  <meta charset="UTF-8" />
  <title>0.3 is here! | Cubos</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="https://cubosengine.org/static/m-dark.compiled.css" />
  <link rel="icon" href="https://cubosengine.org/images/favicon.png" type="image/png" />
  <link rel="canonical" href="https://cubosengine.org/03-is-here.html" />
  <link href="https://cubosengine.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Cubos" />
  <link href="https://cubosengine.org/feeds/release.atom.xml" type="application/atom+xml" rel="alternate" title="Cubos | Release" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
  <meta property="og:site_name" content="Cubos" />
  <meta property="og:title" content="0.3 is here!" />
  <meta name="twitter:title" content="0.3 is here!" />
  <meta property="og:url" content="https://cubosengine.org/03-is-here.html" />
  <meta property="og:description" content="Cubos 0.3 Release!" />
  <meta name="twitter:description" content="Cubos 0.3 Release!" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:type" content="article" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="./" id="m-navbar-brand" class="m-col-t-9 m-col-m-none m-left-m"><img src="https://cubosengine.org/images/favicon.png" alt="" />Cubos</a>
      <a id="m-navbar-show" href="#navigation" title="Show navigation" class="m-col-t-3 m-hide-m m-text-right"></a>
      <a id="m-navbar-hide" href="#" title="Hide navigation" class="m-col-t-3 m-hide-m m-text-right"></a>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-12 m-col-m-none">
            <li><a href="https://docs.cubosengine.org">Docs</a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main>
<div class="m-container">
  <div class="m-row">
    <article class="m-col-m-10 m-nopadb">
      <header>
        <h1><a href="https://cubosengine.org/03-is-here.html" rel="bookmark" title="Permalink to 0.3 is here!">
          <time class="m-date" datetime="2024-08-02T10:00:00+01:00">
            Aug <span class="m-date-day">02</span> 2024
          </time>
          0.3 is here!
        </a></h1>
        <p>Cubos 0.3 Release!</p>
      </header>
      <div class="m-clearfix-l"></div>
<!-- content -->
<section id="new-0-3-features">
<h2>New 0.3 Features</h2>
<p>On this release, we focused on adding essential features we've been wanting to have for quite some time now.
It ended up being a tad smaller than expected, as we spent a lot of time working on non-code related stuff, such as rebranding the project.
<strong>TODO: should we introduce the rebranding here?</strong></p>
<p>This blog post covers the most important changes, but you can check out the full changelog in our <a href="https://github.com/GameDevTecnico/cubos/blob/main/CHANGELOG.md">repository</a>.</p>
<section id="on-the-editor">
<h3>On the Editor</h3>
<section id="console-plugin-scarface1809">
<h4>Console Plugin <span class="m-text m-dim">(&#64;Scarface1809)</span></h4>
<p>TODO: describe changes, add a screenshot</p>
</section>
</section>
<section id="on-the-engine">
<h3>On the Engine</h3>
<section id="a-new-physics-solver-fallenatlas">
<h4>A New Physics Solver <span class="m-text m-dim">(&#64;fallenatlas)</span></h4>
<p>Upon discovering some potential issues with regards to NVidia's patent of XPBD, some problems with how XPBD handled friction, and stability,
we decided that this would be the ideal moment to switch to another solver.
Recently, Erin Catto shared his <a href="https://box2d.org/posts/2024/02/solver2d/">comparison of multiple solvers</a>, and the results of TGS Soft seemed quite promising, so we decided to give it a try... And at this point, our simulation is already more stable than before!</p>
<p>In simple terms, it differs from XPBD in the sense that it uses impulses instead of changing the position of the bodies directly, however, like XPBD it also uses substeps. On top of this it also uses soft constraints, which is what Soft stands for in it's name.</p>
<p>Since these changes were mostly in internal systems, from a user stand point, everything works the same way.</p>
<p>Additionally, we added Friction and Bounciness. For now, these are a predefined value for every body, but will be customizable in the next release with a <code>PhysicsMaterial</code>.</p>
<img class="m-image" src="images/complex_physics_sample_tgs_soft.gif" />
</section>
<section id="raycasting-diogomsmiranda">
<h4>Raycasting <span class="m-text m-dim">(&#64;diogomsmiranda)</span></h4>
<p>Raycasting is a commonly used tool in game development which we Cubos were lacking until now!</p>
<p>Raycasting is a technique used to determine the intersection of a ray with an object in a scene, right now in Cubos there are 2 shapes of colliders,
the <code>BoxCollisionShape</code> and the <code>CapsuleCollisionShape</code>.</p>
<p>Because of this, the new system argument <code>Raycast</code> implementation can be divided into 2 parts, <strong>collision with boxes</strong> and <strong>collision with capsules</strong> (notice that a sphere is a capsule with no height).</p>
<p><strong>Collision with a Box</strong></p>
<p>The collision with a box is based on the Cyrus-Beck algorithm, which is a line clipping algorithm that is used to find the intersection of a line segment with a convex polygon.</p>
<p>We can easily define a box by the minimum and maximum values of x,y,z and the ray by its origin and the direction.</p>
<p>A ray is defined then by the line formula:</p>
<div class="formula">
<i>point</i> = <i>ray</i>.<i>origin</i> + <i>t</i>*<i>ray</i>.<i>direction</i>
</div>
<p>Being t a scalar value that represents the distance from the ray's origin to the point.</p>
<p>Our objective is to find t, and check if the point is in the &quot;right&quot; side of the ray (the side that the ray is pointing to).</p>
<p>For that we can rearrange the previous formula to:</p>
<div class="formula">
<i>t</i> = (<i>point</i> − <i>ray</i>.<i>origin</i>) ⁄ <i>ray</i>.<i>direction</i>
</div>
<div class="formula">
<i>OR</i>(<i>when</i><i>decomposed</i><i>in</i><i>x</i>, <i>y</i>, <i>z</i>)
</div>
<div class="formula">
<i>tX</i> = (<i>point</i>.<i>x</i> − <i>ray</i>.<i>origin</i>.<i>x</i>) ⁄ <i>ray</i>.<i>direction</i>.<i>x</i><i>tY</i> = (<i>point</i>.<i>y</i> − <i>ray</i>.<i>origin</i>.<i>y</i>) ⁄ <i>ray</i>.<i>direction</i>.<i>y</i><i>tZ</i> = (<i>point</i>.<i>z</i> − <i>ray</i>.<i>origin</i>.<i>z</i>) ⁄ <i>ray</i>.<i>direction</i>.<i>z</i>
</div>
<p>If the point is in the right side of the ray, then the intersection point is the point that is closest to the ray's origin.</p>
<p>Now, the only thing that we still need to account is, that most of the times, we have 2 intersection points, one going in, and one going out.</p>
<p>For this we can change the way we use this formulas by instead of using the point, we use the minimum and maximum values of the box.</p>
<p>If both our t's make sense, then we have an intersection.</p>
<p>Here is an excerpt taken from the <code>Raycast</code> class:</p>
<pre class="m-code"><span class="k">static</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="nf">intersects</span><span class="p">(</span><span class="n">cubos</span><span class="o">::</span><span class="n">engine</span><span class="o">::</span><span class="n">Raycast</span><span class="o">::</span><span class="n">Ray</span><span class="w"> </span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">cubos</span><span class="o">::</span><span class="n">core</span><span class="o">::</span><span class="n">geom</span><span class="o">::</span><span class="n">Box</span><span class="w"> </span><span class="n">box</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">(...)</span>

<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">tMinX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">tMaxX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">tMinY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">tMaxY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">tMinZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">tMaxZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// find the maximum of the min</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">tMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">tMinX</span><span class="p">,</span><span class="w"> </span><span class="n">tMaxX</span><span class="p">),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">tMinY</span><span class="p">,</span><span class="w"> </span><span class="n">tMaxY</span><span class="p">)),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">tMinZ</span><span class="p">,</span><span class="w"> </span><span class="n">tMaxZ</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// find the minimum of the max</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">tMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">tMinX</span><span class="p">,</span><span class="w"> </span><span class="n">tMaxX</span><span class="p">),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">tMinY</span><span class="p">,</span><span class="w"> </span><span class="n">tMaxY</span><span class="p">)),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">tMinZ</span><span class="p">,</span><span class="w"> </span><span class="n">tMaxZ</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tMax</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">tMin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tMax</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">-1.0F</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">tMin</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0F</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">tMax</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">tMin</span><span class="p">;</span>
<span class="p">};</span></pre>
<p><strong>Collision with a Capsule</strong></p>
<p>The collision with a capsule is more straight forward than the collision with a box, as we can separate a capsule into 3 parts,
a cylinder and the two spheres at the ends.</p>
<p>We then can check for a point of intersection by checking if the ray intersects the cylinder, and if it doesn't, we check if it intersects the spheres.</p>
<p>We can determine both intersections by simply subbing the the ray's equation for x and z in the cylinder and sphere equations, and then solving it for t.</p>
<p>Code excerpt from raycast.cpp for the cylinder intersection:</p>
<pre class="m-code"><span class="k">static</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="nf">intersects</span><span class="p">(</span><span class="n">cubos</span><span class="o">::</span><span class="n">engine</span><span class="o">::</span><span class="n">Raycast</span><span class="o">::</span><span class="n">Ray</span><span class="w"> </span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">top</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">bottom</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// We are gonna use the quadratic equation made by subbing the ray equation into the cylinder equation</span>
<span class="w">    </span><span class="c1">// The cylinder equation is:</span>
<span class="w">    </span><span class="c1">// x^2 + z^2 = r^2</span>
<span class="w">    </span><span class="c1">// The ray equation is:</span>
<span class="w">    </span><span class="c1">// x = x0 + t * dx</span>
<span class="w">    </span><span class="c1">// z = z0 + t * dz</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">discriminant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">discriminant</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">-1.0F</span><span class="p">;</span><span class="w"> </span><span class="c1">// no intersection with the cylinder</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discriminant</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discriminant</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="p">);</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="p">);</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0F</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">max</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0F</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">-1.0F</span><span class="p">;</span><span class="w"> </span><span class="c1">// no valid intersection</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">direction</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">top</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">-1.0F</span><span class="p">;</span><span class="w"> </span><span class="c1">// intersection is outside the finite cylinder</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="p">};</span></pre>
<p>To use the <code>Raycast</code> argument system, you can simply call the system <code>Raycast.fire</code> that takes a <code>Ray</code> as an argument.</p>
<pre class="m-code"><span class="n">cubos</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;raycast&quot;</span><span class="p">).</span><span class="n">call</span><span class="p">([](</span><span class="n">Raycast</span><span class="w"> </span><span class="n">raycast</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// raycast from the origin to -50,0,0</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">hit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Raycast</span><span class="p">.</span><span class="n">fire</span><span class="p">({{</span><span class="mf">0.0F</span><span class="p">,</span><span class="mf">0.0F</span><span class="p">,</span><span class="mf">0.0F</span><span class="p">},{</span><span class="mf">-50.0F</span><span class="p">,</span><span class="mf">0.0F</span><span class="p">,</span><span class="mf">0.0F</span><span class="p">}});</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hit</span><span class="p">.</span><span class="n">contains</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// hit.point is the point where the ray hit the object</span>
<span class="w">        </span><span class="c1">// hit.entitiy is the entity that was hit</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span></pre>
</section>
<section id="spot-light-shadows-tomas7770">
<h4>Spot Light Shadows <span class="m-text m-dim">(&#64;tomas7770)</span></h4>
<p>Our graphics renderer has received a new major feature in this release: shadows!</p>
<img class="m-image" src="images/scraps_vs_zombies_shadows.png" />
<p>It should go without saying that this feature has a big impact on the visuals of games
developed with Cubos. We've tried it on <em>Scraps vs Zombies</em> and the result is stunning!
It's an important step towards the kind of appealing graphics that we hope to achieve.</p>
<p>For the time being, shadows support is limited to spot lights. To enable them, all you need
to do is add a <a href="https://docs.cubosengine.org/structcubos_1_1engine_1_1SpotShadowCaster.html">SpotShadowCaster</a> component to the spot lights for which you want shadows to be cast,
as shown in the <a href="https://github.com/GameDevTecnico/cubos/tree/main/engine/samples/render/shadows">Shadows sample</a>.
Both hard and soft shadows are supported, with a configurable <a href="https://docs.cubosengine.org/structcubos_1_1engine_1_1ShadowCaster.html#a450e1d2c732f1c38403a428eb0536660">blurRadius</a>.</p>
<p>Behind the scenes, this works by rendering the world from each light's perspective to determine which parts
are occluded, and making these parts unlit. A large texture known as the &quot;shadow atlas&quot; holds this information for
every light in a quadtree structure, reducing expensive texture switching. Finally, soft shadows are implemented
as a post-processing step that effectively blurs out the shadows.
Below is a screenshot of the shadow atlas with 5 spot lights. Lines have been drawn separating
the areas of the atlas reserved for each light.</p>
<img class="m-image" src="images/shadow_atlas.png" />
</section>
<section id="initial-ui-plugin-diogomendonc-a">
<h4>Initial UI Plugin <span class="m-text m-dim">(&#64;DiogoMendonc-a)</span></h4>
<p>TODO: describe changes, add screenshots, maybe gifs too?</p>
</section>
<section id="arbitrary-input-combinations-for-actions-and-axes-luishfonseca">
<h4>Arbitrary Input Combinations for Actions and Axes <span class="m-text m-dim">(&#64;luishfonseca)</span></h4>
<p>TODO: describe changes, show input bindings example</p>
<p>TODO: describe changes, add screenshots, maybe gifs too?</p>
</section>
</section>
<section id="on-the-core">
<h3>On the Core</h3>
<section id="metrics-roby2014">
<h4>Metrics <span class="m-text m-dim">(&#64;roby2014)</span></h4>
<p>We are excited to introduce the new metrics and profiling utilities!
This started becoming a priority since we detected lots of performance issues in the last Game Jam we participated.</p>
<p>These tools are designed to help track performance and gather valuable insights about code execution and data.</p>
<p>How it looks:</p>
<pre class="m-code"><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">compute</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">CUBOS_PROFILE</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// after the scope ends, a new metric `compute` will be added, with the duration of this scope</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">myFunction</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// simulate profiling loop</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1337</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// simulate frame by calling a function that does work..</span>
<span class="w">        </span><span class="n">compute</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// register some metrics, this could be FPS, entities count, ....</span>
<span class="w">        </span><span class="n">CUBOS_METRIC</span><span class="p">(</span><span class="s">&quot;count&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span></pre>
<p>Currently, metrics can be accessed manually through the singleton class. However, we plan to
integrate these metrics into our editor for a more streamlined experience.</p>
<p>Learn more about it on our <a href="https://docs.cubosengine.org/examples-core-metrics.html">metrics documentation</a> :</p>
</section>
<section id="networking-utilities-roby2014">
<h4>Networking Utilities <span class="m-text m-dim">(&#64;roby2014)</span></h4>
<p>In the 0.3 release, Cubos finally has networking! This is a big step forward for our engine, bringing
powerful networking utilities such as ` Address &lt;<a class="m-link-wrap" href="https://docs.cubosengine.org/classcubos_1_1core_1_1net_1_1Address.html">https://docs.cubosengine.org/classcubos_1_1core_1_1net_1_1Address.html</a>&gt;`_,
<a href="https://docs.cubosengine.org/classcubos_1_1core_1_1net_1_1UdpSocket.html">UdpSocket</a>, <a href="https://docs.cubosengine.org/classcubos_1_1core_1_1net_1_1TcpListener.html">TcpListener</a>,
and <a href="https://docs.cubosengine.org/classcubos_1_1core_1_1net_1_1TcpStream.html">TcpStream</a>.</p>
<p>Creating an UDP client and sending a message is as simple as:</p>
<pre class="m-code"><span class="n">UdpSocket</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<span class="n">client</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="o">::</span><span class="n">LocalHost</span><span class="p">);</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, I&#39;m a Cubos UDP client!&quot;</span><span class="p">;</span>
<span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span><span class="w"> </span><span class="n">Address</span><span class="o">::</span><span class="n">from</span><span class="p">(</span><span class="s">&quot;server.com&quot;</span><span class="p">),</span><span class="w"> </span><span class="mi">8081</span><span class="p">))</span></pre>
<p>Learn more about it on our <a href="https://docs.cubosengine.org/examples-core-networking.html">networking documentation</a> :</p>
</section>
<section id="groundwork-for-a-standalone-editor-riscadoa">
<h4>Groundwork for a Standalone Editor <span class="m-text m-dim">(&#64;RiscadoA)</span></h4>
<p>The original main goal for this version was to get a first prototype of our standalone editor working.
Sadly, I didn't manage to get it done in time, as it was a bigger task than I anticipated.</p>
<p>The initial approach, to which I dedicated most of my time, was to have two instances of Cubos running at the same time, on the <strong>same process</strong> - one for the editor and one for the game.
The game instance would be running within the editor instance, and would be launched by loading the game's code from a shared library (such as a DLL).
With this separation, it would be possible for the editor to interact with the game, pause it, restart it and so on, even across game code changes, without having to restart the editor.</p>
<p>So, with this in mind, I restructured some parts of the code base to get it flexible enough to support this kind of setup.
Namely, it is now possible to step Cubos instances, reset them, restart them, and other similar operations.
I also added cross platform support for loading Cubos instances from shared libraries, so that we could load the game from the editor.</p>
<p>This all seems, at first, perfect, but after discussing with the team, we realized that this approach of having two Cubos instances in the same process is not ideal at all.
Any game crash would bring down the editor, any memory leak in the game would affect the editor, and infinite loops in the game would freeze the editor.
Since solving the halting problem isn't in our roadmap, we decided that we should discard this approach, and instead try to keep the <strong>editor and the game in two separate processes</strong>.</p>
<p>So, for the next release, I'll be focusing on following this new approach. It will be a big task, and it will be a lot more difficult, as it will require a lot of inter-process communication, but it will be worth it in the end.
It will allows us to have a stable editor, whose performance is not affected (that much at least) by the game, and vice-versa.</p>
</section>
</section>
</section>
<section id="next-steps">
<h2>Next Steps</h2>
<p><strong>TODO: I just copied this from the previous post, we should rewrite it:</strong>
We're very happy with the progress we've made on this release. The engine is becoming more and more powerful, and we were able to create a full game with it in a week!</p>
<p>For the next release, which should be out in September, we'll be <strong>WIP</strong></p>
<ul>
<li>A <strong>standalone editor application</strong>. Our tools are currently integrated into the games themselves which is not ideal.</li>
<li><strong>Audio support</strong>, as there's no sound at all in the engine right now.</li>
<li>Actual <strong>voxel collisions</strong>, as we currently only check the bounding boxes.</li>
<li>Basic <strong>rigidbody physics</strong>, with rotation and friction.</li>
<li><strong>Shadows</strong> for all light types.</li>
<li><strong>Web-support</strong>, so that games can be played in the browser.</li>
<li><strong>Tracing and spans</strong>, for better tracking of program execution.</li>
<li><strong>TODO: what else? review stuff above too</strong></li>
</ul>
<p>You can check out the full list of stuff we want to get done in the <a href="https://github.com/GameDevTecnico/cubos/milestone/27">milestone</a> for the next release.</p>
<p>We're currently a team of 13 people, and <strong>we're looking to expand</strong>! If you're interested in joining us, or just want to learn more about the project, join our <a href="https://discord.gg/WjTtcNTRqD">Discord server</a>!</p>
</section>
<!-- /content -->
      <footer>
        <p>Posted by <a href="https://cubosengine.org/author/cubos-team.html">Cubos Team</a> on <time datetime="2024-08-02T10:00:00+01:00">Fri 02 August 2024</time> in <a href="https://cubosengine.org/category/release.html">Release</a>.</p>
      </footer>
    </article>
    <nav class="m-navpanel m-col-m-2">
      <h3>Categories</h3>
      <ol class="m-block-bar-m">
        <li><a href="https://cubosengine.org/category/features.html">Features</a></li>
        <li><a href="https://cubosengine.org/category/meta.html">Meta</a></li>
        <li><a href="https://cubosengine.org/category/release.html">Release</a></li>
      </ol>
      <h3>Tag cloud</h3>
      <ul class="m-tagcloud">
        <li class="m-tag-5"><a href="https://cubosengine.org/tag/core.html">Core</a></li>
        <li class="m-tag-5"><a href="https://cubosengine.org/tag/ecs.html">ECS</a></li>
      </ul>
    </nav>
  </div>
</div>
</main>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-s-3 m-col-t-6">
        <h3><a href="https://cubosengine.org/">Cubos</a></h3>
        <ul>
          <li><a href="https://docs.cubosengine.org/getting-started.html">Getting Started</a></li>
          <li><a href="https://docs.cubosengine.org/features.html">Feature Guide</a></li>
          <li><a href="https://docs.cubosengine.org/examples.html">Examples</a></li>
          <li><a href="https://docs.cubosengine.org/contribution.html">Contribution Guidelines</a></li>
        </ul>
      </div>
      <div class="m-col-s-3 m-col-t-6">
        <h3><a href="https://docs.cubosengine.org">Docs</a></h3>
        <ul>
          <li><a href="https://docs.cubosengine.org/pages.html">Pages</a></li>
          <li><a href="https://docs.cubosengine.org/modules.html">Modules</a></li>
          <li><a href="https://docs.cubosengine.org/annotated.html">Classes</a></li>
          <li><a href="https://docs.cubosengine.org/files.html">Files</a></li>
        </ul>
      </div>
      <div class="m-clearfix-t"></div>
      <div class="m-col-s-3 m-col-t-6">
        <h3><a href="mailto:team@cubosengine.org">Contact Us</a></h3>
        <ul>
          <li><a href="https://cubosengine.org/feeds/all.atom.xml">Blog Feed</a></li>
          <li><a href="https://github.com/GameDevTecnico/cubos">GitHub</a></li>
          <li><a href="https://discord.gg/WjTtcNTRqD">Discord</a></li>
          <li><a href="mailto:team@cubosengine.org">E-mail</a></li>
        </ul>
      </div>
      <div class="m-col-s-3 m-col-t-6">
        <h3><a href="https://cubosengine.org/">Blog</a></h3>
        <ul>
          <li><a href="https://cubosengine.org/category/features.html">Features</a></li>
          <li><a href="https://cubosengine.org/category/meta.html">Meta</a></li>
          <li><a href="https://cubosengine.org/category/release.html">Release</a></li>
        </ul>
      </div>
    </div>
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Cubos. Powered by <a href="https://getpelican.com">Pelican</a> and <a href="https://mcss.mosra.cz">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>